<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dienstplan mit Wagen-Nummern</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  button { margin: 5px 10px 10px 0; padding: 8px 16px; cursor: pointer; }
  table { border-collapse: collapse; width: 100%; margin-top: 15px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
</style>
</head>
<body>

<h1>Dienstplan Übersicht mit Wagen-Nummern</h1>

<div>
  <button onclick="showDienste('schule')">Mo-Fr Schule</button>
  <button onclick="showDienste('ferien')">Mo-Fr Ferien</button>
  <button onclick="showDienste('samstag')">Samstag</button>
  <button onclick="showDienste('sonntag')">Sonntag</button>
  <button onclick="updateFahrer()">Busfahrer & Wagen aktualisieren</button>
</div>

<table id="dienstTabelle">
  <thead>
    <tr>
      <th>Dienst</th>
      <th>Fahrzeug</th>
      <th>Busfahrer</th>
      <th>Wagennummer</th>
    </tr>
  </thead>
  <tbody>
    <!-- Daten kommen hier rein -->
  </tbody>
</table>

<script>
// Fahrernamen-Liste
const fahrernamen = ["Müller", "Schmidt", "Schneider", "Fischer", "Weber", "Meyer", "Wagner", "Koch", "Neumann", "Schulz", "Becker", "Hoffmann", "Krause", "Richter", "Wolf", "Lang", "Schröder", "Schwarz", "Zimmermann", "Braun"];

// Wagengruppen
const wagen18m = [39,40,41,47,48,49,55,56];
const wagen15m = [28,29,36,37,38];
const wagen12m = [];
for(let i=1; i<=66; i++) {
  if(!wagen18m.includes(i) && !wagen15m.includes(i)) wagen12m.push(i);
}

// Dienste-Daten mit Fahrzeugtyp (10m, 15m, 18m, oder "–" als 12m)
const dienste = {
  schule: [
    { dienst: "4101", fahrzeug: "10m" },
    { dienst: "4102", fahrzeug: "–" },
    { dienst: "4201", fahrzeug: "18m" },
    { dienst: "4202", fahrzeug: "15m" },
    { dienst: "4203", fahrzeug: "–" },
    { dienst: "4204", fahrzeug: "–" },
    { dienst: "4401", fahrzeug: "18m" },
    { dienst: "4402", fahrzeug: "18m" },
    { dienst: "4403", fahrzeug: "–" },
    { dienst: "4404", fahrzeug: "–" },
    { dienst: "4405", fahrzeug: "–" },
    { dienst: "4406", fahrzeug: "–" },
    { dienst: "4407", fahrzeug: "–" },
    { dienst: "4408", fahrzeug: "–" },
    { dienst: "4409", fahrzeug: "–" }
  ],
  ferien: [
    { dienst: "4501", fahrzeug: "–" },
    { dienst: "4502", fahrzeug: "–" },
    { dienst: "4503", fahrzeug: "–" },
    { dienst: "4504", fahrzeug: "–" },
    { dienst: "4505", fahrzeug: "–" },
    { dienst: "4506", fahrzeug: "–" },
    { dienst: "4507", fahrzeug: "–" },
    { dienst: "4508", fahrzeug: "–" },
    { dienst: "4509", fahrzeug: "–" },
    { dienst: "4510", fahrzeug: "–" },
    { dienst: "4601", fahrzeug: "–" },
    { dienst: "4602", fahrzeug: "10m" },
    { dienst: "4701", fahrzeug: "–" },
    { dienst: "4702", fahrzeug: "–" }
  ],
  samstag: [
    { dienst: "4561", fahrzeug: "–" },
    { dienst: "4562", fahrzeug: "–" },
    { dienst: "4563", fahrzeug: "–" },
    { dienst: "4564", fahrzeug: "–" },
    { dienst: "4565", fahrzeug: "–" },
    { dienst: "4566", fahrzeug: "–" },
    { dienst: "4661", fahrzeug: "–" },
    { dienst: "4662", fahrzeug: "10m" },
    { dienst: "4761", fahrzeug: "–" }
  ],
  sonntag: [
    { dienst: "4571", fahrzeug: "–" },
    { dienst: "4572", fahrzeug: "–" },
    { dienst: "4573", fahrzeug: "–" },
    { dienst: "4574", fahrzeug: "–" },
    { dienst: "4671", fahrzeug: "–" },
    { dienst: "4771", fahrzeug: "–" }
  ]
};

// Hilfsfunktion: passende Wagenliste je Fahrzeugtyp zurückgeben
function getWagenListe(fahrzeug) {
  if(fahrzeug === "18m") return wagen18m;
  if(fahrzeug === "15m") return wagen15m;
  // "–" oder "10m" gilt als 12m
  return wagen12m;
}

// Hilfsfunktion: Array mischen (Fisher-Yates)
function shuffle(array) {
  let a = array.slice();
  for(let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// Für jeden Dienst Fahrer + Wagen eindeutig zuordnen
function assignFahrerUndWagen(diensteListe) {
  // Zufällige Fahrernamen mischen und passend zuordnen
  const namenPool = shuffle(fahrernamen);
  
  // Wagen nach Fahrzeugtyp gruppieren, jeweils gemischt
  // Jeder Dienst bekommt einen Wagen aus passendem Pool
  const gruppen = {
    "18m": shuffle(wagen18m),
    "15m": shuffle(wagen15m),
    "12m": shuffle(wagen12m)
  };
  
  const result = [];
  let namenIndex = 0;
  let zähler = { "18m":0, "15m":0, "12m":0 };
  
  diensteListe.forEach(d => {
    // Fahrzeugtyp normalisieren (– => 12m)
    let ftyp = d.fahrzeug === "–" ? "12m" : d.fahrzeug;
    if(ftyp !== "18m" && ftyp !== "15m" && ftyp !== "12m") ftyp = "12m"; // falls z.B. 10m, auch 12m behandeln

    const wagenListe = gruppen[ftyp];
    const wagenNr = wagenListe[zähler[ftyp] % wagenListe.length];
    zähler[ftyp]++;
    
    result.push({
      dienst: d.dienst,
      fahrzeug: d.fahrzeug === "–" ? "12m" : d.fahrzeug,
      fahrer: namenPool[namenIndex++ % namenPool.length],
      wagen: wagenNr
    });
  });
  
  return result;
}

const tbody = document.querySelector("#dienstTabelle tbody");
let aktuellerTyp = "schule";

function renderTable(data) {
  tbody.innerHTML = "";
  data.forEach(e => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${e.dienst}</td>
      <td>${e.fahrzeug}</td>
      <td>${e.fahrer}</td>
      <td>${e.wagen}</td>
    `;
    tbody.appendChild(tr);
  });
}

function showDienste(typ) {
  aktuellerTyp = typ;
  const daten = assignFahrerUndWagen(dienste[typ]);
  renderTable(daten);
}

function updateFahrer() {
  showDienste(aktuellerTyp);
}

// Initial
showDienste(aktuellerTyp);
</script>

</body>
</html>
